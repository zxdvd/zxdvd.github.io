<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.17" />

  <title>python: default parameter of function &middot; zxdvd&#39;s notes</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

  
  

  
  

  

  <link rel="shortcut icon" href="https://zxdvd.github.ioimg/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="/">zxdvd</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/post/"><i class='fa fa-list fa-fw'></i>Posts</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/topics/"><i class='fa fa-folder fa-fw'></i>Topics</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/tags/"><i class='fa fa-tags fa-fw'></i>Tags</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/zxdvd" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small></small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>python: default parameter of function</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>05 Aug 2015, 00:00</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="https://zxdvd.github.iotags/python">python</a>
    
  </div>
  
  

</div>

  <p>I&rsquo;ll show a small peice of code at first:</p>

<pre><code>:::python
&gt;&gt;&gt; def foo(a=[]):
...   a.append(1)
...   print(a)
...
&gt;&gt;&gt; foo()
[1]
&gt;&gt;&gt; foo()
[1, 1]
&gt;&gt;&gt; foo()
[1, 1, 1]
&gt;&gt;&gt; foo
&lt;function foo at 0x7efc48708bf8&gt;
</code></pre>

<p>I was confused by this when first met it years ago. A lot of people, me
included, may think that list <strong>a</strong> should always be <strong>[1]</strong> and why it behaviors like a
global variable.</p>

<h4 id="everything-is-an-object">Everything is an object</h4>

<p>We frequently see this quote but it&rsquo;s not easy to understand.</p>

<p>In python, a function is an object too. This object is created after definition.
And the function name is just like a reference to the object. And the default
parameter of the function is also determined at the same time.</p>

<p></p>

<p>Following is official documentation of <a href="https://docs.python.org/3.5/reference/compound_stmts.html#function-definitions">function
definitions</a></p>

<pre><code>:::text
Default parameter values are evaluated from left to right when the function
definition is executed. This means that the expression is evaluated once,
when the function is defined, and that the same “pre-computed” value is used
for each call. This is especially important to understand when a default
parameter is a mutable object, such as a list or a dictionary: if the
function modifies the object (e.g. by appending an item to a list), the
default value is in effect modified. This is generally not what was
intended. A way around this is to use None as the default, and
explicitly test for it in the body of the function.
</code></pre>

<p>Summary: default parameter is evaluated only ONCE at the creation of the
function object. It&rsquo;s NOT evaluated when the function is called.</p>

<p>Another piece of code:</p>

<pre><code>:::python
&gt;&gt;&gt; def foo(a=[]):
...   print('id of a is: ', id(a))
...   a.append(1)
&gt;&gt;&gt; dir(foo)
['__annotations__', '__call__', '__class__', '__closure__', '__code__',
'__defaults__', '__delattr__', '__dict__', '__dir__', ... ... ]
&gt;&gt;&gt; foo.__defaults__
([],)
&gt;&gt;&gt; foo()
id of a is:  139897639740424
&gt;&gt;&gt; foo.__defaults__
([1],)
&gt;&gt;&gt; foo()
id of a is:  139897639740424
&gt;&gt;&gt; foo.__defaults__
([1, 1],)
</code></pre>

<p>We could see that after definition of the function, we have object foo. It has a
lot of attributes just like other classes. And the value of default parameter
are stored at the <strong>__default__</strong>. At first, it has an empty list. It&rsquo;s appended
once the function is called. Moreover, the id of a is not changed while it is
called at the second time.</p>

<p>Now I think we can explain it.</p>

<p>Default parameters are valuated and stored at the __default__ attribute of the
function object. If it is mutable like list, it may be modified (like the
<code>a.append(1)</code> in the example) and the modification will be kept.</p>

<h4 id="reference">Reference:</h4>

<ol>
<li><a href="http://www.jeffknupp.com/blog/2013/02/14/drastically-improve-your-python-understanding-pythons-execution-model">Understanding Python&rsquo;s Execution Model</a></li>
<li><a href="http://stackoverflow.com/questions/1132941/least-astonishment-in-python-the-mutable-default-argument">The Mutable Default Argument</a></li>
</ol>

  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="https://zxdvd.github.io/post/summary-curl-bugzilla/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="https://zxdvd.github.io/post/summary-curl-bugzilla/">Summary: the curl bugzilla project</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="https://zxdvd.github.io/post/travis-update-github-page/">配置travis自动更新github page</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="https://zxdvd.github.io/post/travis-update-github-page/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>

</div>
</div>
<script src="https://zxdvd.github.iojs/ui.js"></script>




</body>
</html>

